# Users API — Register Endpoint

This document describes the POST /users/register endpoint for the Backend service.

## Endpoint

- URL: `/users/register`
- Method: `POST`

## Purpose

Create a new user account. The endpoint validates input, hashes the password, stores the user in the database, and returns a newly-created user object together with a JWT auth token.

## Request

- Content-Type: `application/json`

- Body (JSON):

  {
    "fullname": {
      "firstname": "string (required, min 3 chars)",
      "lastname": "string (optional, min 3 chars)"
    },
    "email": "string (required, valid email)",
    "password": "string (required, min 6 chars)"
  }

Validation rules (applied by `express-validator` and Mongoose schema):

- `fullname.firstname`: required, minimum length 3 characters.
- `fullname.lastname`: optional, but if provided should be minimum length 3.
- `email`: required, must be a valid email address, minimum length 5, and must be unique.
- `password`: required, minimum length 6.

If validation fails, the endpoint responds with HTTP 400 and a JSON payload containing the validation errors.

## Responses

- 201 Created
  - Description: User successfully created.
  - Body (example):

    {
      "user": {
        "_id": "<user id>",
        "fullname": { "firstname": "John", "lastname": "Doe" },
        "email": "john@example.com",
        "socketId": null
      },
      "token": "<jwt token>"
    }

  Note: The password field is not returned in the response.

- 400 Bad Request
  - Description: Input validation failed.
  - Body (example):

    {
      "errors": [
        { "msg": "Invalid email address", "param": "email", "location": "body" },
        { "msg": "First name must be at least 3 characters long", "param": "fullname.firstname", "location": "body" }
      ]
    }

- 500 Internal Server Error
  - Description: Unexpected error creating user (e.g., database error, duplicate email not handled by validation).
  - Body (example):

    {
      "error": "Internal server error"
    }

## Notes & Implementation details

- Passwords are hashed before storing (bcrypt) — the API expects a plain password in the request and the controller hashes it via the model helper before creating the user.
- A JWT token is generated by the user model method `generateAuthToken` using `process.env.JWT_SECRET`. Ensure `JWT_SECRET` is configured in environment variables for token creation to succeed.
- The endpoint uses `express-validator` checks defined in `routes/user.routes.js` to perform basic validation before controller logic runs.

## Example cURL

```bash
curl -X POST http://localhost:3000/users/register \
  -H "Content-Type: application/json" \
  -d '{
    "fullname": { "firstname": "Jane", "lastname": "Doe" },
    "email": "jane.doe@example.com",
    "password": "secret123"
  }'
```

Replace the host/port with your server's address.

----

File created to document the `/users/register` endpoint. Keep this README updated when the endpoint behavior or validations change.

## Login Endpoint

This section documents the POST `/users/login` endpoint used to authenticate existing users and return a JWT token.

### Endpoint

- URL: `/users/login`
- Method: `POST`

### Request

- Content-Type: `application/json`

- Body (JSON):

  {
    "email": "string (required, valid email)",
    "password": "string (required, min 6 chars)"
  }

Validation rules (defined in `routes/user.routes.js`):

- `email`: required, must be a valid email address.
- `password`: required, minimum length 6.

If validation fails, the endpoint responds with HTTP 400 and a JSON payload containing the validation errors.

### Responses

- 200 OK
  - Description: Authentication successful.
  - Body (example):

    {
      "user": {
        "_id": "<user id>",
        "fullname": { "firstname": "John", "lastname": "Doe" },
        "email": "john@example.com",
        "socketId": null
      },
      "token": "<jwt token>"
    }

- 400 Bad Request
  - Description: Input validation failed (missing/invalid email or password length).
  - Body: same shape as register validation errors: { errors: [...] }

- 401 Unauthorized
  - Description: Invalid email or password.
  - Body (example):

    { "message": "Invalid email or password" }

- 500 Internal Server Error
  - Description: Unexpected error (database, token generation, etc.).

### Example cURL

```bash
curl -X POST http://localhost:3000/users/login \
  -H "Content-Type: application/json" \
  -d '{ "email": "john@example.com", "password": "secret123" }'
```

### Notes

- The controller uses `userService.findUserByEmail(email).select('+password')` to fetch the user including the hashed password, and then calls `user.comparePassword(password)` to verify credentials.
- On success, a JWT token is generated with `user.generateAuthToken()` and returned alongside the user object (password excluded).

